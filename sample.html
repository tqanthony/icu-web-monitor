<html>
<head>
    <title>Simple ECG chart</title>
    <meta name="viewport" content="width=device-width, user-scalable=no"> 
    <script>
        var data = [123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 124, 124, 124, 125, 125, 125, 125, 125, 125, 125, 125, 124, 124, 124, 124, 124, 123, 122, 122, 122, 122, 122, 122, 123, 123, 123, 123, 122, 122, 122, 122, 122, 124, 134, 151, 172, 190, 199, 196, 181, 161, 143, 131, 125, 125, 125, 124, 124, 124, 124, 124, 124, 124, 124, 124, 123, 122, 122, 122, 122, 122, 122, 122, 122, 123, 124, 124, 124, 124, 125, 125, 125, 125, 127, 128, 128, 128, 128, 128, 129, 130, 130, 130, 130, 130, 130, 130, 130, 129, 129, 129, 128, 127, 127, 126, 126, 125, 125, 125, 125, 124, 124, 123, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 124, 125, 125, 125, 125, 125, 125, 125, 125, 126, 126, 125, 123, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 123, 123, 123, 123, 122, 122, 122, 122, 121, 122, 132, 149, 171, 190, 200, 200, 186, 165, 146, 133, 126, 124, 124, 124, 123, 123, 123, 123, 123, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 123, 123, 123, 123, 123, 124, 125, 125, 125, 126, 127, 127, 127, 127, 128, 129, 130, 130, 130, 130, 130, 130, 130, 130, 130, 129, 127, 126, 126, 126, 126, 126, 125, 124, 124, 124, 124, 124, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 124, 124, 124, 124, 124, 125, 125, 125, 125, 125, 125, 123, 122, 122, 122, 122, 121, 121, 121, 121, 121, 121, 122, 122, 122, 122, 122, 121, 121, 121, 121, 121, 125, 137, 157, 179, 196, 201, 195, 178, 157, 139, 128, 124, 124, 124, 123, 123, 123, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 123, 123, 123, 123, 125, 126, 126, 126, 127, 127, 127, 128, 128, 129, 130, 130, 130, 130, 130, 130, 130, 130, 129, 129, 129, 129, 127, 126, 126, 126, 126, 125, 125, 124, 124, 124, 124, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 125, 125, 125, 125, 125, 126, 126, 126, 126, 126, 125, 124, 124, 124, 124, 123, 122, 122, 122, 122, 122, 122, 122, 123, 123, 123, 122, 122, 122, 122, 122, 122, 125, 136, 154, 174, 191, 198, 193, 177, 157, 139, 129, 125, 124, 124, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 124, 124, 124, 125, 125, 125, 125, 126, 127, 128, 129, 129, 129, 129, 130, 130, 130, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 124, 124, 124, 124, 124, 125, 125, 125, 125, 124, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 121, 121, 121, 121, 121, 121, 125, 136, 153, 174, 191, 199, 195, 178, 158, 140, 130, 124, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 123, 123, 123, 124, 125, 125, 125, 126, 127, 127, 127, 127, 128, 129, 130, 130, 130, 130, 130, 131, 131, 131, 131, 130, 130, 129, 128, 128, 128, 128, 127, 126, 125, 125, 125, 124, 124, 124, 124, 124, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 123, 123, 123, 123, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 124, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 124, 123, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 123, 123, 123, 123, 122, 122, 122, 122, 122, 128, 142, 162, 183, 199, 201, 193, 174, 154, 138, 129, 125, 124, 124, 124, 124, 124, 124, 124, 124, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 124, 124, 124, 124, 124, 125, 126, 127, 127, 127, 127, 128, 129, 129, 130, 130, 131, 131, 131, 131, 131, 131, 131, 131, 130, 130, 130, 130, 129, 127, 127, 127, 127, 126, 125, 125, 125, 125, 125, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 124, 125, 125, 126, 126, 126, 126, 126, 126, 126, 126, 126, 125, 125, 124, 124, 123, 123, 123, 123, 123, 123, 123, 123, 124, 124, 124, 124, 124, 124, 123, 122, 122, 128, 140, 158, 178, 194, 199, 192, 174, 155, 139, 130, 125, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 125, 125, 125, 125, 126, 127, 127, 127, 128, 128, 130, 130, 130, 130, 130, 131, 131, 131, 131, 131, 131, 130, 129, 128, 127, 127, 127, 127, 126, 126, 125, 125, 124, 124, 124, 124, 124, 124, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 124, 124, 125, 125, 125, 125, 125, 125, 125, 125, 125, 124, 124, 124, 123, 122, 122, 122, 122, 122, 122, 122, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 127, 141, 160, 181, 196, 200, 193, 174, 153, 138, 129, 125, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 123, 122, 122, 122, 122, 122, 122, 122, 123, 123, 123, 123, 123, 124, 125, 125, 125, 125, 127, 127, 127, 127, 128, 128, 130, 130, 130, 130, 130, 130, 130, 130, 130, 129, 129, 129, 128, 127, 127, 127, 126, 125, 125, 125, 125, 125, 124, 124, 124, 124, 124, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 124, 122, 122, 122, 122, 122, 121, 121, 121, 122, 123, 123, 123, 123, 123, 122, 121, 121, 121, 121, 122, 128, 143, 164, 186, 200, 200, 190, 171, 151, 136, 127, 124, 124, 124, 124, 123, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 123, 123, 123, 124, 125, 125, 125, 125, 127, 127, 128, 128, 128, 128, 129, 129, 129, 129, 129, 129, 129, 129, 129, 128, 127, 127, 125, 125, 125, 125, 125, 124, 124, 124, 124, 124, 124, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 123, 123, 123, 124, 124, 124, 124, 125, 125, 125, 124, 123, 122, 122, 122, 122, 122, 121, 121, 121, 121, 121, 122, 123, 123, 122, 121, 121, 121, 121, 121, 121, 124, 136, 155, 177, 194, 200, 196, 179, 158, 141, 129, 124, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 121, 121, 121, 121, 121, 121, 121, 122, 122, 122, 122, 123, 123, 124, 124, 124, 125, 126, 127, 127, 127, 127, 128, 128, 128, 128, 128, 129, 129, 129, 129, 129, 129, 129, 128, 127, 126, 126, 125, 125, 124, 124, 124, 124, 124, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 124, 124, 124, 124, 124, 125, 125, 125, 125, 125, 125, 124, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 123, 123, 122, 121, 121, 121, 121, 121, 124, 136, 156, 179, 197, 203, 199, 181, 160, 141, 130, 125, 124, 124, 124, 123, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 123, 123, 123, 123, 124, 125, 125, 125, 125, 127, 127, 127, 127, 128, 129, 130, 130, 130, 130, 130, 130, 130, 129, 129, 128, 128, 127, 127, 127, 127, 127, 127, 125, 124, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 123, 125, 125, 125, 125, 125, 125, 125, 125, 124, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 123, 122, 122, 122, 122, 122, 122, 122, 131, 146, 166, 186, 197, 197, 186, 166, 147, 133, 127, 125, 124, 123, 123, 123, 123, 123, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 124, 125, 125, 125, 125, 126, 126, 127, 127, 128, 128, 128, 128, 128, 129, 129, 129, 129, 129, 129, 129, 129, 128, 127, 125, 125, 125, 124, 124, 124, 124, 124, 124, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 122, 122, 122, 123, 123, 123, 123, 123, 123, 124, 125, 125, 124, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 123, 122, 121, 121, 121, 121, 121, 121, 125, 138, 158, 179, 196, 201, 195, 176, 155, 139, 129, 125, 123, 122, 122, 122, 122, 122, 122, 121, 121, 121, 121, 121, 120, 120, 120, 121, 121, 121, 122, 122, 123, 123, 123, 123, 123, 124, 124, 125, 125, 126, 126, 126, 126, 127, 128, 128, 128, 128, 128, 129, 129, 129, 129, 129, 129, 129, 127, 126, 126, 125, 125, 124, 124, 124, 124, 124, 124, 123, 123, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 122, 123, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 121, 121, 121, 121, 121, 121, 125, 137, 157, 180, 197, 201, 195, 177, 157, 139, 129, 124, 123, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 123, 123, 123, 125, 125, 125, 125, 125, 125, 127, 127, 128, 128, 128, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 128, 127, 125, 125, 124, 124, 124, 124, 124, 124, 124, 124, 124, 123, 123, 123, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 123, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 124, 123, 123, 122, 122, 122, 122, 122, 122, 122, 123, 123, 123, 123, 123, 122, 122, 122, 122, 122, 125, 136, 154, 176, 194, 202, 198, 181, 161, 142, 131, 125, 124, 124, 124, 124, 124, 124, 124, 124, 124, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123, 125, 125, 125, 125, 125, 127, 127, 127, 127, 128, 129, 129, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 129, 129, 129, 129, 127, 127, 126, 126, 126, 126, 125, 125, 125, 125, 125, 125, 125, 125, 125, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 125, 125, 125, 125, 125, 125, 126, 127, 127, 127, 125, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 125, 125, 124, 123, 123, 123, 123, 123, 123, 127, 137, 154, 173, 190, 197, 193, 178, 158, 142, 132, 127, 125, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 124, 125, 125, 126, 126, 126, 127, 127, 128, 128, 128, 128, 130, 130, 130, 130, 131, 131, 131, 131, 131, 131, 131, 130, 130, 129, 129, 128, 127, 126, 125, 125, 125, 125, 125, 125, 125, 125, 125, 124, 124, 124, 124, 124, 124, 123, 123, 123, 123, 123, 123, 123, 123, 123, 123
        ];
        var _data = data.slice();   
        var WINDOW_POINTS = 150;     
        var gl, line_program, rect_program, numPointsLoc, pointLoc, rectLoc;
        var vbo_line, vbo_rect;

        var v_shader_line = `
            uniform float numPoints; 
            uniform float maxVal;
            uniform float minVal;
            attribute vec2 point;           
           
            void main(void) {
                float y = 2.0 * (point[0] - minVal) / (maxVal - minVal) - 1.0;
                float x = 2.0 * point[1] / numPoints - 1.0; 
                gl_Position = vec4(x, y, 0.0, 1.0);               
            }
        `;
        var f_shader_line = `            
            void main(void) {
                gl_FragColor = vec4(0.0, 1.0, 0.0, 0.1);                
            }
        `;   
        var v_shader_rect= `           
            attribute vec2 coord;           
           
            void main(void) {                
                gl_Position = vec4(coord, 0.0, 1.0);               
            }
        `;
        var f_shader_rect = `            
            void main(void) {
                gl_FragColor = vec4(0.0, 0.0, 0.0, 0.1);                
            }
        `;  
        
        function createShader(gl, shader_type, shader_src) {
            // console.log(shader_type);
            if (!(shader_type == gl.VERTEX_SHADER) && !(shader_type == gl.FRAGMENT_SHADER) ) {
                console.log('Shader type:', shader_type, ' not supported');
                return false;
            }
            var shader = gl.createShader(shader_type);
            var precision = ''
            + "#  ifdef GL_FRAGMENT_PRECISION_HIGH \n"
            + "     precision highp float;         \n"
            + "#  else                             \n"
            + "     precision mediump float;       \n"
            + "#  endif ";                         
            gl.shaderSource(shader, shader_src);
            gl.compileShader(shader);
            var compileOk = gl.getShaderParameter(shader, gl.COMPILE_STATUS);
            if (!compileOk) {
                console.error('Error in creating shader\n', shader_src);
                console.log(gl.getShaderInfoLog(shader));
                return false;
            }
            return shader;
        }

        function createProgram(gl, v_shader, f_shader) {
            program = gl.createProgram();
            gl.attachShader(program, v_shader);
            gl.attachShader(program, f_shader);
            gl.linkProgram(program);
            var linkOk = gl.getProgramParameter(program, gl.LINK_STATUS);
            if (!linkOk) {
                console.error('glLinkProgram:');
                return false;
            }
            return program;
        }


        function init() {
            //WebGL context
            var canvas = document.createElement('canvas');
            canvas.setAttribute('id', 'screen');
            canvas.setAttribute('style', 'background: yellow; width: 600px; height: 300px; ');
            document.body.appendChild(canvas);                
            gl = canvas.getContext('webgl', { alpha: false }); 
            // vertex buffers
            vbo_line= gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, vbo_line);
            gl.bindBuffer(gl.ARRAY_BUFFER, null);
            vbo_rect= gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, vbo_rect);
            gl.bindBuffer(gl.ARRAY_BUFFER, null);
            //programs
            vertShaderLine = createShader(gl, gl.VERTEX_SHADER, v_shader_line);
            fragShaderLine = createShader(gl, gl.FRAGMENT_SHADER, f_shader_line);
            line_program = createProgram(gl, vertShaderLine, fragShaderLine);
            if (!line_program) {
                console.log('Error creating LINE program');
                return false;
            }
            gl.useProgram(line_program);   
            maxValLoc = gl.getUniformLocation(line_program, 'maxVal');
            minValLoc = gl.getUniformLocation(line_program, 'minVal');
            maxVal = _data.reduce((a, b) => Math.max(a, b), -Infinity);
            minVal = _data.reduce((a, b) => Math.min(a, b), Infinity);
            console.log('max val:', maxVal, ', min val:', minVal);
            gl.uniform1f(maxValLoc, maxVal + 50);            
            gl.uniform1f(minValLoc, minVal - 50);   
            numPointsLoc = gl.getUniformLocation(line_program, 'numPoints');
            gl.uniform1f(numPointsLoc, WINDOW_POINTS);   
            pointLoc = gl.getAttribLocation(line_program, "point");
            gl.vertexAttribPointer(pointLoc, 2, gl.FLOAT, false, 0, 0); 
            gl.enableVertexAttribArray(pointLoc); 

            vertShaderRect = createShader(gl, gl.VERTEX_SHADER, v_shader_rect);
            fragShaderRect = createShader(gl, gl.FRAGMENT_SHADER, f_shader_rect);
            rect_program = createProgram(gl, vertShaderRect, fragShaderRect);
            if (!line_program) {
                console.log('Error creating RECT program');
                return false;
            }
            rectLoc = gl.getAttribLocation(rect_program, "coord");
            gl.vertexAttribPointer(rectLoc, 2, gl.FLOAT, false, 0, 0); 
            gl.enableVertexAttribArray(rectLoc);   
            //buffers
            vbo_line= gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, vbo_line);
            gl.bindBuffer(gl.ARRAY_BUFFER, null);
            vbo_rect = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, vbo_rect);
            gl.bindBuffer(gl.ARRAY_BUFFER, null);

            //background
            // background and otherss
           //gl.clearColor(0.0, 0.0, 1.0, 1.0);
            gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
            gl.clear(gl.COLOR_BUFFER_BIT);
        }

        function scale(min, max) {
            var delta = max - min;
            return function (val) {
                return 2 * (val - min) / delta - 1;
            };
        }

        function draw(data, pos, pad_length) {
            var pad_length_norm = pad_length/gl.drawingBufferWidth;   
            var pos_norm =  [pos].map(scale(0, WINDOW_POINTS))[0];
           
            //draw line:
            gl.useProgram(line_program);
            gl.bindBuffer(gl.ARRAY_BUFFER, vbo_line);
            gl.vertexAttribPointer(pointLoc, 2, gl.FLOAT, false, 0, 0);            
            // Enable the attribute
            gl.enableVertexAttribArray(pointLoc); 
            var bufferData =  new Float32Array(data.length * 2) ;            
            var sampleData = data;
            var index_arr = Array.from(Array(data.length).keys());
            for (var i = 0; i < data.length; i++) {
                bufferData[i*2] = sampleData[i];
                bufferData[i*2 + 1] = index_arr[i];
            }  
                     
            gl.bufferData(gl.ARRAY_BUFFER, bufferData, gl.STATIC_DRAW);    
            gl.drawArrays(gl.LINE_STRIP, 0, data.length); 
            

            //draw rect
            gl.useProgram(rect_program);
            gl.bindBuffer(gl.ARRAY_BUFFER, vbo_rect);
            gl.vertexAttribPointer(rectLoc, 2, gl.FLOAT, false, 0, 0); 
            gl.enableVertexAttribArray(rectLoc)           
            var rectData = [pos_norm, -1,pos_norm,1,pos_norm + pad_length_norm,1,pos_norm, -1,pos_norm + pad_length_norm,1,pos_norm + pad_length_norm,-1];
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(rectData), gl.STATIC_DRAW);  
            gl.drawArrays(gl.TRIANGLES, 0, 6);
        }

        function main() {
            var step = 5;            
            var pad_pos = 0;
            var pad_length = 55;
            var applyPad =  false;
            var sliding_data = [];                      

            init();
            requestAnimationFrame(drawScene); 
            function drawScene(now) {               
                var chunk = _data.splice(0, step).reverse();               
                sliding_data = chunk.concat(sliding_data);
                pad_pos += step               
                if (sliding_data.length > WINDOW_POINTS) { 
                    //console.log('sliding data', sliding_data, ',pad position', pad_pos); 
                    var trunc_length = sliding_data.length - WINDOW_POINTS;
                    sliding_data.splice(sliding_data.length - trunc_length, trunc_length);
                }
                draw(sliding_data, pad_pos, pad_length);
                if ((pad_pos ) >= WINDOW_POINTS) {
                    pad_pos = -step ;
                }            
                
                if (_data.length > 0) {
                    setTimeout(function() {requestAnimationFrame(drawScene);}, 100);
                    // requestAnimationFrame(drawScene);
                }
            }
        }
    </script>
</head>

<body onload="main()">
</body>
</html>